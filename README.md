ご要望に合わせて更新した `README.md` のMarkdownソースです。
そのままコピーして `README.md` ファイルとして保存してください。

```markdown
# Safe Unmount Mac

Macで複数の外付けドライブを安全かつ確実に一括アンマウントするためのスクリプトです。
Time Machineのバックアップ動作を検知して停止させる機能や、システムドライブの自動除外機能を備えており、カーネルパニック（強制再起動）やデータ破損を防ぎます。

## 特徴

- **Time Machineの自動制御** バックアップ実行中の場合、`tmutil` を使用して安全に停止・待機してからアンマウント処理に入ります。「ディスクが使用中です」というエラーを防ぎます。

- **スマートな対象判定** `diskutil info` を使用して「取り出し可能（Ejectable）」なディスクのみを自動判別します。ドライブ名をコードに書き込む必要がなく、内蔵SSDやシステム領域を誤って操作するリスクがありません。

- **キャッシュのフラッシュ** `sync` コマンドでメモリ上のキャッシュを物理ディスクに強制的に書き込み、データの整合性を保ちます。

- **負荷分散** 1ドライブごとに待機時間を挟みながら順次処理することで、OSの負荷集中によるフリーズやクラッシュを回避します。

## 動作環境

- macOS
- Zsh (macOS Catalina以降の標準シェル)

## 使い方

1. スクリプトをダウンロード（または作成）し、ディレクトリへ移動します。

2. スクリプトに実行権限を与えます。
   ```bash
   chmod +x safe_eject.zsh

```

3. スクリプトを実行します。
```bash
./safe_eject.zsh

```



## 処理の流れ

1. **Time Machine チェック**: バックアップ中であれば停止し、完全に止まるまで待機。
2. **Sync**: ディスクキャッシュを物理書き込み。
3. **Loop**: `/Volumes` 内の各ドライブを走査。
* `diskutil info` で Ejectable 属性を確認。
* システムドライブや非リムーバブルメディアはスキップ。


4. **Eject**: 対象ドライブをアンマウント（完了後、少し待機して次のドライブへ）。

## 注意事項

* 本スクリプトは `diskutil eject` を使用して安全に取り出しを行いますが、開いているファイルがある場合などはOSの仕様によりアンマウントがキャンセルされることがあります。

```

```